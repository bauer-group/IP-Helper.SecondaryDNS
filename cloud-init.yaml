#cloud-config
# =============================================================================
# Secondary DNS Server - Cloud-Init
# =============================================================================
#
# Lädt install.sh von GitHub und führt es aus.
# Alle Parameter sind im .env Block unten - einfach anpassen und deployen!
#
# GitHub: https://github.com/bauer-group/IP-Helper.SecondaryDNS
#
# =============================================================================

write_files:
  # ###########################################################################
  #
  #                    PARAMETER - HIER ANPASSEN
  #
  # ###########################################################################
  - path: /tmp/.env
    permissions: "0600"
    content: |
      # =========================================================================
      # PFLICHTANGABEN
      # =========================================================================

      PRIMARY_DNS_IP="203.0.113.10"
      PRIMARY_DNS_HOSTNAME="ns1.example.com"
      ADMIN_EMAIL="admin@example.com"

      # =========================================================================
      # OPTIONAL: SSH
      # =========================================================================

      SSH_PUBKEY="ssh-ed25519 AAAAC3... admin@example.com"
      SSH_PASSWORD_AUTH="true"

      # =========================================================================
      # OPTIONAL: SERVER
      # =========================================================================

      SECONDARY_HOSTNAME="ns2"
      SECONDARY_FQDN="ns2.example.com"
      TIMEZONE="Etc/UTC"

      # =========================================================================
      # OPTIONAL: AUTO-UPDATE
      # =========================================================================

      AUTO_REBOOT="true"
      REBOOT_TIME="03:00"

# ###########################################################################
#
#                    AB HIER NICHTS ÄNDERN
#
# ###########################################################################

runcmd:
  - curl -fsSL https://raw.githubusercontent.com/bauer-group/IP-Helper.SecondaryDNS/main/install.sh -o /tmp/install.sh
  - chmod +x /tmp/install.sh
  - /tmp/install.sh

power_state:
  delay: "+1"
  mode: reboot
  message: "Installation abgeschlossen. Server wird neu gestartet..."
  timeout: 30
  condition: true
